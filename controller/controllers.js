// var crypto = require('crypto');
var ProgList = require('../models/ProgList.js');
var AllData = require('../models/AllData.js');

exports.index = function(req, res) {
	res.render('index', {
		title: 'Clairvoyant',
		req: req,
		res: res
	});
};

exports.intro = function(req, res) {
	res.render('intro', {
		title: 'Clairvoyant',
		req: req,
		res: res
	});
};

exports.intro2 = function(req, res) {
	res.render('intro2', {
		title: 'Clairvoyant',
		req: req,
		res: res
	});
};

exports.demo = function(req, res) {
	res.render('demo', {
		title: 'Clairvoyant',
		req: req,
		res: res
	});
};

exports.about = function(req, res) {
	res.render('about', {
		title: 'Clairvoyant',
		req: req,
		res: res
	});
};

/************
	APIs
 ************/

exports.proglist = function(req, res) {
	var strDate = req.body.strDate;

	ProgList.get(strDate, function(err, result){
		if (err) {
			console.warn(err);
		}
		res.send(result);
	});
	// res.send([{ "progid" : 565035, "progname" : "识法代言人[粤][6]", "genre" : "情感剧;家庭剧;职业剧;" },{ "progid" : 566027, "progname" : "故梦[21]", "genre" : "情感剧;家庭剧;民国剧;" },{ "progid" : 557404, "progname" : "烈火雄心II[35]", "genre" : "情感剧;励志剧;职业剧;" },{ "progid" : 560553, "progname" : "故梦[7]", "genre" : "情感剧;家庭剧;民国剧;" },{ "progid" : 560555, "progname" : "故梦[8]", "genre" : "情感剧;家庭剧;民国剧;" },{ "progid" : 560560, "progname" : "故梦[9]", "genre" : "情感剧;家庭剧;民国剧;" },{ "progid" : 553250, "progname" : "风雨雕花楼[18]", "genre" : "情感剧;" },{ "progid" : 553254, "progname" : "风雨雕花楼[19]", "genre" : "情感剧;" },{ "progid" : 553259, "progname" : "风雨雕花楼[20]", "genre" : "情感剧;" },{ "progid" : 547411, "progname" : "望族[33]", "genre" : "家族剧;商战剧;" }]);
};
exports.data = function(req, res) {
	var pid = parseInt(req.body.pid);

	AllData.get(pid, function(err, result) {
		if (err) {
			console.warn(err);
		}
		// Reduce the num of neighbors
		result.neighborData = result.neighborData;
		res.send(result);
	});
	// var result = {};
	// result.selectedSeries = {};
 //    result.selectedSeries['real'] = [65.0, 849.0, 983.0, 910.0, 874.0, 581.0, 460.0, 376.0, 338.0, 236.0, 220.0, 200.0, 206.0, 199.0, 184.0, 163.0, 156.0, 152.0, 125.0, 127.0, 164.0, 113.0, 78.0, 85.0, 66.0, 62.0, 74.0, 75.0, 91.0, 96.0, 90.0, 57.0, 68.0, 54.0, 64.0, 48.0, 45.0];
 //    result.selectedSeries['pred'] = [434.0, 352.0, 325.0, 324.0, 280.0, 244.0, 214.0, 196.0, 163.0, 168.0, 154.0, 134.0, 113.0, 114.0, 99.0, 87.0, 89.0, 95.0, 89.0, 77.0, 76.0, 78.0, 69.0, 74.0, 76.0, 66.0, 58.0, 60.0, 68.0, 66.0];
 //    // result.selectedSeries['realStartDate'] = '2013-04-19';
 //    result.selectedSeries['predStartDate'] = '2013-04-26';
 //    // Neighbor data
 //    result.neighborData = [];
 //    result.neighborData = [
 //    {'progid': 8757013, 'sim':0.9824058297147681, "progname" : "天子寻龙[12]", "genre" : "神话剧;", 'series':[53, 351, 399, 449, 344, 246, 247, 192, 190, 174, 189, 143, 128, 107, 87, 96, 88, 65, 55, 68, 66, 51, 39, 40, 38, 31, 38, 39, 42, 39, 33, 30, 19, 18, 23, 34, 29, 22, 20, 24, 28, 22, 27, 35, 16, 21, 26, 11, 15, 13, 11, 19, 9, 8, 22, 10, 20, 5, 7, 8, 9, 8, 13, 13, 12, 12, 7, 13]},
 //    {'progid': 8653291, 'sim':0.9814743406175027, "progname" : "天子寻龙[13]", "genre" : "神话剧;", 'series': [145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8757011, 'sim':0.9775720466903759,  "progname" : "你睡觉的时候[韩][8]", "genre" : "言情剧;伦理剧;", 'series':[454, 2215, 2724, 2659, 2202, 1792, 1450, 1161, 983, 988, 938, 547, 517, 495, 534, 422, 442, 425, 366, 320, 264, 237, 245, 292, 269, 198, 177, 136, 153, 121, 155, 154, 161, 132, 103, 120, 112, 76, 74, 72, 75, 79, 106, 87, 95, 90, 77, 87, 70, 75, 77, 103, 87, 70, 99, 75, 64, 76, 98, 112, 56, 70, 63, 79, 66, 95, 89, 1]},
 //    {'progid': 8683288, 'sim':0.9758256374918414, "progname" : "幸运草[韩][7]", "genre" : "言情剧;伦理剧;", 'series':[43, 370, 418, 458, 352, 271, 248, 202, 183, 172, 164, 149, 124, 109, 88, 96, 93, 54, 61, 49, 64, 47, 37, 39, 37, 27, 33, 34, 43, 32, 34, 34, 22, 19, 31, 36, 34, 22, 24, 30, 25, 22, 32, 34, 13, 22, 29, 16, 22, 11, 10, 16, 12, 8, 17, 17, 18, 8, 5, 9, 8, 7, 13, 11, 12, 11, 12, 8]},
 //    {'progid': 8683390, 'sim':0.9726336138391816, "progname" : "你睡觉的时候[韩][85]", "genre" : "言情剧;伦理剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8653287, 'sim':0.9650255042450495, "progname" : "拿什么拯救你我的爱人[9]", "genre" : "言情剧;伦理剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8683293, 'sim':0.9622259866564998, "progname" : "拿什么拯救你我的爱人[10]", "genre" : "言情剧;伦理剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8757008, 'sim':0.9620645850467124, "progname" : "蝾螈道士和影子操作团[韩][4]", "genre" : "言情剧;偶像剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8675248, 'sim':0.9617245706049526, "progname" : "智勇新警界[7]", "genre" : "警匪剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8664986, 'sim':0.9611805674075347, "progname" : "坏男人[韩][7]", "genre" : "言情剧;偶像剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8753906, 'sim':0.9602227175187023, "progname" : "二马new[11]", "genre" : "伦理剧;传记剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8668466, 'sim':0.9597360853492118, "progname" : "二马new[12]", "genre" : "伦理剧;传记剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]},
 //    {'progid': 8684330, 'sim':0.9582618514769541, "progname" : "二马new[13]", "genre" : "伦理剧;传记剧;", 'series':[145, 904, 1194, 953, 945, 674, 568, 486, 203, 167, 184, 171, 177, 207, 162, 119, 112, 138, 155, 78, 86, 94, 80, 71, 86, 90, 83, 91, 109, 84, 81, 71, 76, 85, 67, 81, 63, 68, 72, 48, 60, 63, 55, 49, 56, 46, 49, 44, 65, 41, 47, 45, 40, 28, 37, 36, 37, 39, 35, 25, 19, 13, 23, 28, 20, 18, 8, 13, 16, 18, 14, 21, 16, 14, 9, 15, 9, 16, 23, 17, 17, 22, 19, 16, 20, 20, 14, 19, 20, 13, 15, 16, 18, 28, 17, 18, 25, 30, 25, 18, 19, 19, 15, 13, 21, 13, 13, 23, 20, 15, 17, 23, 18, 22, 19, 19, 17, 8, 20, 13]}
 //    ];
	// res.send(result);
};